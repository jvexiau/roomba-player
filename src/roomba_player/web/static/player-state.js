(function () {
  const config = window.ROOMBA_PLAYER_CONFIG || {};
  const refs = {
    controlStatus: document.getElementById("ctrlStatus"),
    telemetryStatus: document.getElementById("telemetryStatus"),
    logNode: document.getElementById("log"),
    speedSlider: document.getElementById("speedSlider"),
    speedValue: document.getElementById("speedValue"),
    cameraFeed: document.getElementById("cameraFeed"),
    cameraBox: document.getElementById("cameraBox"),
    cameraOverlay: document.getElementById("cameraOverlay"),
    cameraMessage: document.getElementById("cameraMessage"),
    arucoStatusNode: document.getElementById("arucoStatus"),
    activeInputsNode: document.getElementById("activeInputs"),
    executedCommandNode: document.getElementById("executedCommand"),
    batteryPctNode: document.getElementById("batteryPct"),
    batteryBar: document.getElementById("batteryBar"),
    batteryMahNode: document.getElementById("batteryMah"),
    robotStateNode: document.getElementById("robotState"),
    bumperStateNode: document.getElementById("bumperState"),
    bumperAnyStateNode: document.getElementById("bumperAnyState"),
    wheelDropStateNode: document.getElementById("wheelDropState"),
    wheelDropAnyStateNode: document.getElementById("wheelDropAnyState"),
    cliffStateNode: document.getElementById("cliffState"),
    wallStateNode: document.getElementById("wallState"),
    chargingSourceStateNode: document.getElementById("chargingSourceState"),
    dockStateNode: document.getElementById("dockState"),
    linkStateNode: document.getElementById("linkState"),
    distanceStepMmNode: document.getElementById("distanceStepMm"),
    angleStepDegNode: document.getElementById("angleStepDeg"),
    totalDistanceMmNode: document.getElementById("totalDistanceMm"),
    totalAngleDegNode: document.getElementById("totalAngleDeg"),
    encoderCountsNode: document.getElementById("encoderCounts"),
    planStaticCanvas: document.getElementById("planStaticCanvas"),
    planRobotCanvas: document.getElementById("planRobotCanvas"),
    poseTextNode: document.getElementById("poseText"),
    planFileInput: document.getElementById("planFile"),
  };

  const state = {
    controlWs: null,
    telemetryWs: null,
    activeInputs: new Set(),
    lastCommandSignature: "",
    currentPlan: null,
    planProjection: null,
    currentOdom: { x_mm: 0, y_mm: 0, theta_deg: 0 },
    bumpLeft: false,
    bumpRight: false,
    arucoLogSignature: "",
    arucoPairLogSignature: "",
    arucoFrameLogKey: "",
    arucoHadDetection: false,
  };

  window.RP = { config, refs, state };
})();
