<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>roomba-player / player</title>
    <link rel="stylesheet" href="/static/player.css?v=__ASSET_VERSION__" />
  </head>
  <body>
    <div class="wrap">
      <div class="page-head">
        <div>
          <h1>Player</h1>
          <p class="small">Keyboard AZERTY: Z forward, S backward, Q left, D right. Hold to move, release to stop.</p>
        </div>
        <section class="joy-dock" aria-label="Joystick quick controls">
          <div class="joy joy-mini">
            <div></div>
            <button class="btn hold" data-cmd="forward" id="joyForward">↑</button>
            <div></div>
            <button class="btn hold" data-cmd="left" id="joyLeft">←</button>
            <button class="btn" id="btnCenterStop">■</button>
            <button class="btn hold" data-cmd="right" id="joyRight">→</button>
            <div></div>
            <button class="btn hold" data-cmd="backward" id="joyBackward">↓</button>
            <div></div>
          </div>
        </section>
      </div>

      <div class="top-grid">
        <div class="top-left-stack">
          <section class="camera-wrap card">
            <h2>Camera</h2>
            <div class="camera-box" id="cameraBox">
              <div class="camera-off" id="cameraMessage">Camera stream disabled.</div>
              <img id="cameraFeed" alt="Raspberry camera stream" style="display:none;" />
              <canvas id="cameraOverlay" style="display:none;"></canvas>
            </div>
            <p class="small">ArUco: <strong id="arucoStatus">disabled</strong></p>
          </section>

          <section class="card card-control">
            <h2>Control</h2>
            <div class="status" id="ctrlStatus">control websocket: connecting...</div>
            <div class="toolbar">
              <button class="btn" id="btnInit">init</button>
              <button class="btn" id="btnSafe">mode safe</button>
              <button class="btn" id="btnFull">mode full</button>
              <button class="btn" id="btnClean">clean</button>
              <button class="btn" id="btnDock">dock</button>
              <button class="btn" id="btnStop">stop</button>
            </div>

            <div class="speed">
              <input id="speedSlider" type="range" min="80" max="500" step="10" value="250" />
              <strong><span id="speedValue">250</span></strong>
            </div>

            <p class="small">Active inputs: <strong id="activeInputs">none</strong></p>
            <p class="small">Executed command: <strong id="executedCommand">stop</strong></p>
          </section>
        </div>
        <div class="top-right-stack">
          <section class="card map-card">
            <h2>Salon Map</h2>
            <div class="toolbar">
              <button class="btn" id="btnLoadSalon">load plans/salon.yaml</button>
              <button class="btn" id="btnResetHistory">reset history + start pose</button>
              <input type="file" id="planFile" accept=".json,application/json" />
            </div>
            <p class="small">Odometry pose: <strong id="poseText">x=0 y=0 θ=0°</strong></p>
            <div class="plan-stack">
              <canvas id="planStaticCanvas" width="900" height="380"></canvas>
              <canvas id="planRobotCanvas" width="900" height="380"></canvas>
            </div>
          </section>

          <section class="card sensors-card">
            <h2>Live Sensors</h2>
            <div class="status" id="telemetryStatus">telemetry websocket: connecting...</div>
            <div class="telemetry">
              <div class="metric">
                <div class="k">Battery</div>
                <div class="v"><span id="batteryPct">0</span>%</div>
                <div class="bar"><span id="batteryBar" style="width: 0%"></span></div>
              </div>
              <div class="metric">
                <div class="k">Battery mAh</div>
                <div class="v" id="batteryMah">0 / 0</div>
              </div>
              <div class="metric">
                <div class="k">State</div>
                <div class="v" id="robotState">unknown</div>
              </div>
              <div class="metric">
                <div class="k">Roomba link</div>
                <div class="v" id="linkState"><span class="pill warn">unknown</span></div>
              </div>
              <div class="metric">
                <div class="k">Bumpers</div>
                <div class="v" id="bumperState"><span class="pill warn">unknown</span></div>
              </div>
              <div class="metric">
                <div class="k">Any bumper</div>
                <div class="v" id="bumperAnyState"><span class="pill warn">unknown</span></div>
              </div>
              <div class="metric">
                <div class="k">Wheel drops</div>
                <div class="v" id="wheelDropState"><span class="pill warn">unknown</span></div>
              </div>
              <div class="metric">
                <div class="k">Any wheel drop</div>
                <div class="v" id="wheelDropAnyState"><span class="pill warn">unknown</span></div>
              </div>
              <div class="metric">
                <div class="k">Cliff sensors</div>
                <div class="v" id="cliffState"><span class="pill warn">unknown</span></div>
              </div>
              <div class="metric">
                <div class="k">Wall seen</div>
                <div class="v" id="wallState"><span class="pill warn">unknown</span></div>
              </div>
              <div class="metric">
                <div class="k">Dock visible</div>
                <div class="v" id="dockState"><span class="pill warn">unknown</span></div>
              </div>
              <div class="metric">
                <div class="k">Charging source</div>
                <div class="v" id="chargingSourceState"><span class="pill warn">unknown</span></div>
              </div>
              <div class="metric">
                <div class="k">Distance step</div>
                <div class="v" id="distanceStepMm">0 mm</div>
              </div>
              <div class="metric">
                <div class="k">Angle step</div>
                <div class="v" id="angleStepDeg">0 deg</div>
              </div>
              <div class="metric">
                <div class="k">Total distance</div>
                <div class="v" id="totalDistanceMm">0 mm</div>
              </div>
              <div class="metric">
                <div class="k">Total angle</div>
                <div class="v" id="totalAngleDeg">0 deg</div>
              </div>
              <div class="metric">
                <div class="k">Encoders</div>
                <div class="v" id="encoderCounts">L:0 R:0</div>
              </div>
            </div>
          </section>
        </div>
      </div>

      <div class="bottom-grid">
        <section class="card card-log">
          <h2>Realtime log</h2>
          <pre id="log"></pre>
        </section>
      </div>
    </div>

    <script>
      window.ROOMBA_PLAYER_CONFIG = {
        cameraEnabled: __CAMERA_ENABLED__,
        cameraWidth: __CAMERA_WIDTH__,
        cameraHeight: __CAMERA_HEIGHT__,
        arucoEnabled: __ARUCO_ENABLED__,
        arucoFocalPx: __ARUCO_FOCAL_PX__,
        arucoMarkerSizeCm: __ARUCO_MARKER_SIZE_CM__,
        arucoOverlayFlipX: __ARUCO_OVERLAY_FLIP_X__,
      };
    </script>
    <script src="/static/player-state.js?v=__ASSET_VERSION__"></script>
    <script src="/static/player-utils.js?v=__ASSET_VERSION__"></script>
    <script src="/static/player-map.js?v=__ASSET_VERSION__"></script>
    <script src="/static/player-camera.js?v=__ASSET_VERSION__"></script>
    <script src="/static/player-aruco.js?v=__ASSET_VERSION__"></script>
    <script src="/static/player-controls.js?v=__ASSET_VERSION__"></script>
    <script src="/static/player-telemetry.js?v=__ASSET_VERSION__"></script>
    <script src="/static/player-main.js?v=__ASSET_VERSION__"></script>
  </body>
</html>
